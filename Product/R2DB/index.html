<!DOCTYPE html>
<html lang="ja" id="html">
<head id="head">
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Jukusui" />
    <meta data-ajax="start-head" />
    <title>Redirect To Default Browser - ねむねごメモ</title>
    <meta data-ajax="end-head" />
    <link rel="icon" href="/favicon.ico" />
    <link rel="icon" href="/favicon.svg" type="image/svg" sizes="any" />
    <link rel="mask-icon" href="/favicon.svg" type="image/svg" color="black" />
    <meta name="theme-color" content="#7b00ff" />
    <meta name="apple-mobile-web-app-status-bar-style" content="#7b00ff" />
        <link rel="stylesheet" href="/CSS/main.min.css" />
        <script src="/JS/main.min.js"></script>
    <script src="/Lib/Prism/prism.js"></script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
        extensions: ["jsMath2jax.js"]
        });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/MathJax.js?config=TeX-AMS_HTML&locale=ja"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/7.1.2/mermaid.min.js"></script></head>
<body id="body" class="c1" data-ajax="replace-body-class">
    <input id="menu-checkbox" type="checkbox" />
    <input id="img-checkbox" type="checkbox" />
    <header id="header">
        <label for="menu-checkbox"><span></span><span></span><span></span></label>
        <a href="/">ねむねごメモ</a>
            <a href="/Category/develop/">develop</a>

        <a href="/Product/">product</a>
        <label id="menu-overlay" for="menu-checkbox" class="overlay"></label>
        <span id="img-overlay" class="overlay no-ripple"><span></span></span>
        <label id="img-input" for="img-checkbox"></label>
    </header>
    <meta data-ajax="start-body" />
    <article id="main">
        
<section id="first" class="rect float-box">
    <div class="img-wrapper no-border float-left sm-right" style="height:64px;width:64px">
        <img src="/Images/R2DB.256.png" title="Redirect To Default Browser" alt="アイコン" />
    </div>
    <h1>Redirect To Default Browser</h1>
</section>

<section id="article" class="rect">
    <h2>※注意※</h2>
    <section>
        <p>
            2021/12/19現在、12/14公開のWindows 10 KB5008212及びWindows 11 KB5008215の適用後にmicrosoft-edgeスキームを使用したリダイレクトに対策がなされました。
            そのため、Windows 10及びWindows 11において本アプリケーションは期待通りに動作しません。
            現時点では未適用のユーザーのためストアのページは残しますが、ストアでの検索によるアプリページの表示は行えないようにしてあります。
        </p>
        <p>
            これに対応する修正プログラムを<a href="/Product/R2DB_IFEO">こちら</a>で公開中です。
        </p>
        <details>
            <summary>過去の対応</summary>
            <p>
                単純なWindows Storeアプリケーションとして一定の品質を持って動作するものの作成は、権限としては不可能ではないが、かなりの手間がかかることが判明しました。
                そのため、ユーザー権限のみを使用するアプリケーションの開発は中止し、管理者権限の必要なアプリケーションとしての開発を行うこととしました。
                詳細は<a href="/Memo/R2DB_DllInjection/">こちら</a>。
            </p>
            <p>
                <s>
                    今後、Windows Storeで提供できる権限、ポリシーの範囲内で提供ができないか検討はしていますが、現時点では可能か分からない上、リアルでの多忙もあり年度中での更新はまず不可能と思われます。
                    頻繁に使用する方は別作者の同等機能を持つツールの利用もご検討ください。
                </s>
            </p>
            <p>
                <s>
                    2021/11/12現在、Windows 11 Insider Preview build 22494においてmicrosoft-edgeスキームを使用したリダイレクトに関し、対策がなされました。
                    そのため、Windows 11の更新によっては本アプリケーションが期待通りに動作しなくなる可能性があります。
                </s>
            </p>
        </details>
    </section>
    <h2>なにこれ</h2>
    <section>
        <p>
            Windows 10の一部アプリケーション
            はウェブサイトを開く際、既定のアプリに関係なくMicrosoft Edgeを使用します。
            このアプリはこの挙動に割り込み既定のブラウザで開くことができるアプリです。
        </p>
    </section>
    <h2>対応環境・アプリ</h2>
    <section>
        <p>
            Windows 10 バージョン1803以降のCortanaやタスクバーの検索
        </p>
    </section>
    <h2>配布ページ</h2>
    <section>
        <p>
            Microsoft Storeで配布しています。
        </p>
        <p>
            <a href='//www.microsoft.com/store/apps/9N86NDB1C3MP?ocid=badge'><img src='/Images/Japanese_get it from MS_864X312.svg' alt='Japanese badge' height="64" /></a>
        </p>
    </section>
    <h2>バージョン履歴</h2>
    <section class="version-info">
        <details>
            <summary>1.0.0.0</summary>
            <dl>
                <dt>初回リリース</dt>
                <dd>特記事項無し</dd>
            </dl>
        </details>
        <details>
            <summary>1.1.0.0</summary>
            <dl>
                <dt>アイコン</dt>
                <dd>アイコンの見た目のサイズ調整</dd>
                <dd>Windows 19H1向けの白背景アイコンの追加<s>(現時点ではタスクバー位しか用途が)</s></dd>
                <dd>プログラム自体のアイコンを複数サイズに対応</dd>

                <dt>機能強化</dt>
                <dd>設定ファイルをUWPの機能を使用するように</dd>
                <dd>エラー時に開こうとしたURLをクリップボードに保存できるように</dd>

                <dt>バグ修正</dt>
                <dd>ブラウザで開ける状態にあるかのチェックを強化</dd>
                <dd>アプリ内のハイパーリンクを開いた際にプログラムが異常終了することがあるのを修正</dd>
            </dl>
        </details>
        <details>
            <summary>2.0.0.0</summary>
            <dl>
                <dt>UIが<s>無駄に</s>モダン化</dt>
                <dd>全体のリダイレクトテスト機能が追加</dd>
                <dd>アプリ側に多少の情報はこのWebサイトみたいに載せるように</dd>
                <dd>Acrylic Blur(すりガラスっぽいやつ)やにも対応</dd>
                <dd>完全なFluent Design対応は暇になってもたぶんやらない(特にTitleBar周りでアニメーションさせにくい)</dd>
                <dd><strong>見た目</strong>は<small>たぶん</small>大切</dd>
            </dl>
            <dl>
                <dt>Chromium Edge(新しいEdge)関係の不具合</dt>
                <dd>Edge HTML(旧Edge)を名指しで起動していたのに関連する不具合を修正</dd>
                <dd>今後、前回のURIをEdgeで開きなおす際、ユーザが開くEdgeを選択することになります</dd>
            </dl>
        </details>
        <details open>
            <summary>2.2.0.0</summary>
            <dl>
                <dt>修正パッチへの対応</dt>
                <dd>(コマンド「JukusuiR2DB.exe」での起動に対応)</dd>
                <dt>要パッチなことを明記</dt>
            </dl>
        </details>
    </section>
    <h2>なにをしているの</h2>
    <section>
        <p>
            普通にブラウザを開く際は、「http:」や「https:」といったURLスキーム(Windowsの設定ではプロトコルと呼ばれている)を使います。
            それに対し、「microsoft-edge:」を使用することで、Edgeを指名して開くことができます。
            Cortanaなどのアプリが「microsoft-edge:」から始まるURIを使用して、Edgeを名乗るブラウザを起動するようになっています。
            このアプリは後者でEdgeの代わりに呼び出されるように設定されることで動作し、microsoft-edgeのスキームを通常のhttpやhttpsのURLに変換した上で既定のブラウザで開くことができます。
            呼び出された時に起動し、ブラウザを起動してすぐ終了するという動きを毎回行うため、シンプル(常駐やブラウザ拡張比)ながら安定した<small><s>(DLL Injection比)</s></small>動作ができます。
        </p>
    </section>
    <h2>Q&amp;A</h2>
    <section>
        <dl>
            <dt>Q: Edgeが起動する</dt>
            <dd>
                以下のことを確認して下さい。
                <ol>
                    <li>
                        スタートメニューの全てのアプリケーションに「RedirectToDefaultBrowser」が存在するか確認<br />
                        →ない場合、インストールされていません。
                    </li>
                    <li>
                        スタートメニューから「RedirectToDefaultBrowser」を開き、ウェブページ(画面下部)を開いて何のブラウザが開くか確認<br />
                        →Edgeだった場合、既定のアプリのWebブラウザがEdgeになっています。設定の「<a href="ms-settings:defaultapps">アプリ/既定のアプリ</a>」で変更して下さい。
                    </li>
                    <li>
                        ファイル名を指定して実行(Win + R)に「microsoft-edge:?url=https://www.jukusui.net」を入力してEdgeが開くか確認<br />
                        →希望のブラウザで「開いた」場合、起動元のアプリに対応していません。<a href="/Home/Contact/">お問合せください</a>。
                    </li>
                    <li>
                        設定の「<a href="ms-settings:defaultapps">アプリ/既定のアプリ/</a>プロトコルごとに既定のアプリを選ぶ/MICROSOFT-EDGE」が「RedirectToDefaultBrowser」か確認<br />
                        →違う場合、設定してください
                    </li>
                    <li>
                        インストールやリダイレクトの設定からまだ一度もPCを再起動していない<br />
                        →一度再起動してみてください。(一部のCortanaでの症例)
                    </li>
                </ol>
            </dd>
            <dt>Q: CortanaからURLを開く際「パッケージIDがなんたら」というエラーが出る</dt>
            <dd>
                Windows 10 バージョン1803より前の環境で確認した既知の不具合です。
                正直、こっち側の問題ではなさそうなので直せません。
                OSをバージョンアップすれば直るはずです。
                もしも、アップデートしてもこのエラーが出た場合、<a href="/Home/Contact/">お問合せください</a>。
            </dd>
            <dt>Q: 起動しない。もしくはエラーが出る</dt>
            <dd>
                こちらのページに従って、<a href="/Home/Contact/">お問合せください</a>。
            </dd>
            <dt>Q: リダイレクトの詳しい情報</dt>
            <dd>
                リダイレクトは.Net Framework標準の正規表現ライブラリを使用して置き換えを行っています。
                正規表現では入力文字列、入力パターン、(と出力パターン)が与えられたとき、入力パターンに入力文字列が合致するかを探すことができます。
                Microsoftの<a href="https://docs.microsoft.com/dotnet/standard/base-types/regular-expression-language-quick-reference#substitutions">このページ</a>が分かりやすいです。
                下に例を挙げますが、さらに調整するのならば上のページを見ながらいじると良いでしょう。<br />
                <br />
                検索エンジンを変更する例
                <ul>
                    <li>入力パターン(共通)→<code>^https?://www\.bing\.com/search\?(|.*?&)q=(.*?)(&.*|)$</code></li>
                    <li>出力パターン(Wikipedia)→<code>https://ja.wikipedia.org/w/index.php?search=$2</code></li>
                    <li>出力パターン(Google)→<code>https://www.google.co.jp/search?q=$2</code></li>
                    <li>出力パターン(Yahoo)→<code>https://search.yahoo.co.jp/search?q=$2</code></li>
                </ul>
                この入力パターンの意味は
                <ul>
                    <li><code>^</code>文字列の先頭</li>
                    <li>http</li>
                    <li><code>s?</code>「s」があるかないかのいずれか</li>
                    <li>://www</li>
                    <li><code>\.</code>「.」の入力は「\」とセットにする必要がある(エスケープ)</li>
                    <li>bing</li>
                    <li><code>\.</code>同上</li>
                    <li>com</li>
                    <li><code>\.</code>同上</li>
                    <li>search</li>
                    <li><code>\?</code>「?」の入力にも「\」が必要</li>
                    <li>bing</li>
                    <li>
                        <code>(|.*&)</code>空かURIクエリの区切り文字の「&amp;」があるまで。これは
                        <ul>
                            <li><code>(aaa|bbb|...)</code>のように()で括って「|」で区切るといずれかにマッチすればいいという意味</li>
                            <li><code>(|</code>のように始まるので空の場合と</li>
                            <li><code>|.*&)</code>で終わるので「.*&amp;」にマッチするという意味</li>
                            <li><code>.</code>は好きな文字を意味し</li>
                            <li><code>*?</code>前のパターン(ここでは「.」)を好きな長さ(0以上)、なるべく短いマッチを探そうとする<small>(これが?無しだと二番目以降のqにマッチすることがある)</small></li>
                            <li><code>.*&</code>で何らかの文字列の後、「&amp;」が来るという意味</li>
                        </ul>
                    </li>
                    <li>q=</li>
                    <li>
                        <code>(.*?)</code>最短の好きな文字列とのマッチを無名で保存
                        <ul>
                            <li><code>.*?</code>上同様、マッチする最短の文字列という意味</li>
                            <li><code>(aaa)</code>括弧自体には値をコピーして出力で使うための機能もあり、これは二番目の括弧なので$2で参照できる</li>
                        </ul>
                    </li>
                    <li>
                        <code>(&.*|)</code>「(|.*&)」と順番が逆なだけでほぼ同じことだが
                        <ul>
                            <li><code>.*</code>?の付かない*はなるべく長いマッチを探そうとする</li>
                        </ul>
                    </li>
                    <li><code>$</code>文字列の最後にマッチする</li>
                </ul>
                入力パターンは複雑だが、出力パターンはシンプルで出力したいURLの検索した文字が入る部分に<code>$2</code>を入れればOK。二番目の括弧の中身が入れられる。

            </dd>
        </dl>
    </section>
    <h2>注意点</h2>
    <section>
        <p>
            このアプリを利用した上で生じた損害を一切保証しません。
            また、元々Edgeで開かれる予定であったURLをあなたの選択した既定のブラウザで開くため、開かれたページにおいて何らかの不具合が生じる可能性、ブラウザに個人情報等が渡る可能性があることを十分留意してください。
        </p>
    </section>
    <h2>プライバシーポリシー</h2>
    <section>
        <p>
            このアプリは最後に起動した際のURLをローカルに保持します。それ以外の動作の上で知り得た情報(URLなど)を記録は行いません。
            また、デフォルトに指定されたブラウザとEdgeブラウザ以外のアプリケーションには情報を渡しません。
            さらに、URLで指定されたサーバー以外には情報をネットワークに送信することはありません。
        </p>
        <p>
            なお、スタートメニューで右クリックした際に、最近の記録として複数回のURLを保存されているようですが、アプリケーション側から操作等は行っていません。
        </p>
    </section>
</section>

    </article>
    <meta data-ajax="end-body" />
    <div id="loader">
        <div class="progress-ring"><span></span><span></span><span></span><span></span><span></span><span></span></div>
    </div>
    <footer id="footer">
        <a href="/Home/AboutThisPage/">サイトの詳細</a>
        <a href="/Home/Contact/">問い合わせ先</a>
        <span>©2018 Jukusui</span>
    </footer>
</body>
</html>
