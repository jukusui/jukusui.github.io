function SendAsync(n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return[2,new Promise(function(t,i){n.onreadystatechange=function(){n.readyState===4&&(200<=n.status&&n.status<300?t(!0):i(n.statusText))};n.send()})]})})}function AttachCanceller(n){var i=this,t=[undefined,undefined];return t[1]=new Promise(function(r,u){return __awaiter(i,void 0,void 0,function(){var i,f;return __generator(this,function(e){switch(e.label){case 0:t[0]=function(){r&&(r([!1,null]),r=null,u=null)};e.label=1;case 1:return e.trys.push([1,3,,4]),[4,n];case 2:return i=e.sent(),r&&(r([!0,i]),r=null,u=null),[3,4];case 3:return f=e.sent(),u&&(u(f),r=null,u=null),[3,4];case 4:return[2]}})})}),t}function DOMEventsAsync(n){return[new Promise(function(t){n.readyState==="interactive"||n.readyState==="complete"?t(null):n.addEventListener("DOMContentLoaded",function(n){t(n)})}),new Promise(function(t){n.readyState==="complete"?t(null):window.addEventListener("load",function(n){t(n)})})]}function EventAsync(n,t){return console.info(n.nodeName+":"+t+":START"),new Promise(function(i){var r=function(u){i(u);n.removeEventListener(t,r);console.info(n.nodeName+":"+t+":DONE")};addEventListener(t,r)})}function DoEvents(){return new Promise(function(n){setTimeout(function(){return n(!0)},0)})}var __awaiter=this&&this.__awaiter||function(n,t,i,r){return new(i||(i=Promise))(function(u,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?u(n.value):new i(function(t){t(n.value)}).then(o,s)}e((r=r.apply(n,t||[])).next())})},__generator=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=u[e[0]&2?"return":e[0]?"throw":"next"])&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[0,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i,e;return e={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e},__extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),LoadManager=function(){function n(){this.Listeners=[];this.PreUnLoadFuncs=[];this.AfterUnLoadFuncs=[];this._IsReady=!1;this._IsLoaded=!1}return n.Init=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(i){switch(i.label){case 0:return window.addEventListener("load",function(){return console.info("window.onload")}),[4,DOMEventsAsync(document)];case 1:return t=i.sent(),[4,DoEvents()];case 2:return i.sent(),[4,t[0]];case 3:return i.sent(),n.DOMContentLoaded(),[4,t[1]];case 4:return i.sent(),n.load(),[2]}})})},n.DOMContentLoaded=function(){for(var i,t=0,r=n.Items;t<r.length;t++)i=r[t],i.IsReady||(i.Ready(),i._IsReady=!0)},n.load=function(){for(var i,t=0,r=n.Items;t<r.length;t++)i=r[t],i.IsLoaded||(i.Load(),i._IsLoaded=!0)},n.RaiseUnLoad=function(){for(var i,t=0,r=n.Items;t<r.length;t++)i=r[t],i.UnLoadGlobal(),i._IsLoaded=!1,i._IsReady=!1},n.RaiseReady=function(){MathJax.Hub.Queue(["Typeset",MathJax.Hub]);Prism.highlightAll();mermaid.init();n.DOMContentLoaded()},n.RaiseLoad=function(){n.load()},n.prototype.UnLoadGlobal=function(){var t,i,n;for(this.PreUnLoad(),t=0,i=this.Listeners;t<i.length;t++)n=i[t],n[3]&&n[3](n[0]),n[0].removeEventListener(n[1],n[2]);this.AfterUnLoad();this.Listeners=[]},Object.defineProperty(n.prototype,"IsReady",{get:function(){return this._IsReady},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"IsLoaded",{get:function(){return this._IsLoaded},enumerable:!0,configurable:!0}),n.prototype.addListener=function(n,t,i,r){n.addEventListener(t,i);this.Listeners.push([n,t,i,r])},n.AddItem=function(t){n.Items.push(t)},n.Items=[],n}(),AwaitUtil,Awaiter,MoveState;LoadManager.Init();LoadManager.AddItem(new(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.Ready=function(){var o=document.getElementById("article"),e,u,f;if(o!==null){var t=document.getElementById("img-checkbox"),i=document.getElementById("img-overlay").lastChild,n,r,h=function(u){r=u;n=document.createElement("div");n.classList.add("dumy-img");u.parentNode.insertBefore(n,u);u.parentNode.removeChild(u);i.appendChild(u);t.checked=!0},s=this.close=function(){r&&(i.removeChild(r),n.parentNode.insertBefore(r,n),n.parentNode.removeChild(n),r=null,n=null,t.checked=!1)};for(this.PreUnLoadFuncs.push(s),this.addListener(t,"change",function(){console.log("change="+t.checked);t.checked||s()}),this.addListener(i,"click",function(){i.classList.toggle("raw-size")}),e=o.querySelectorAll("img"),u=0;u<e.length;u++)(f=e[u],f.parentElement.tagName.toLowerCase()!="a")&&(f.classList.add("clickable"),this.addListener(f,"click",function(n){console.log("click="+t.checked);t.checked?i.classList.toggle("raw-size"):h(this);n.stopPropagation()},function(n){return n.classList.remove("clickable")}))}},t.prototype.Load=function(){},t.prototype.PreUnLoad=function(){this.close&&this.close()},t.prototype.AfterUnLoad=function(){},t}(LoadManager)));AwaitUtil=function(){function n(){}return n.Immidiate=function(){return new Promise(function(n){return setImmediate(n)})},n.AnimationFrame=function(){return new Promise(function(n){return requestAnimationFrame(function(){return n()})})},n.Timeout=function(n){return new Promise(function(t){return setTimeout(t,n)})},n}();Awaiter=function(){function n(){var n=this;this.isDone=!1;this.hasError=!1;this.resolve=null;this.reject=null;this.task=new Promise(function(t,i){n.isDone?n.hasError?i(n.reason):t(n.result):(n.resolve=t,n.reject=i)})}return n.prototype.SetResult=function(n){this.isDone||(this.isDone=!0,this.result=n,this.resolve&&this.resolve(n))},n.prototype.ThrowError=function(n){this.isDone||(this.isDone=!0,this.hasError=!0,this.reason=n,this.reject&&this.reject(n))},n}(),function(n){n[n.Cold=0]="Cold";n[n.Removed=1]="Removed";n[n.Replaced=2]="Replaced"}(MoveState||(MoveState={}));history.pushState!==undefined&&window.onpopstate!==undefined&&LoadManager.AddItem(new(function(n){function t(){var t=n.call(this)||this;return t.oldPathName=document.location.pathname,t.moveState=MoveState.Cold,t.canceller=null,t.stack=[],window.addEventListener("popstate",function(){t.Move()}),t}return __extends(t,n),t.prototype.CancelTask=function(){var t,n,i;for(console.debug("Canceled"),t=this.stack.length,n=0;n<t;n++)i=this.stack.shift(),i.SetResult(this.stack.length==0)},t.prototype.Move=function(){return __awaiter(this,void 0,void 0,function(){var h,i,e,t,c,r,l,o,a,u,v,y,f,s,n,p,w;return __generator(this,function(b){switch(b.label){case 0:return(h=this.oldPathName,i=document.location.pathname,this.oldPathName=i,i===h)?[2]:(console.debug("Requested"),!(this.moveState!=MoveState.Cold))?[3,2]:(console.debug("Cancel Requested"),e=new Awaiter,this.stack.push(e),this.canceller(),[4,e.task]);case 1:if(!b.sent())return[2];b.label=2;case 2:console.debug("Started");t=new XMLHttpRequest;t.onabort=function(){return console.info("Cancelled XHR")};t.responseType="document";t.open("GET",i,!0);b.label=3;case 3:return b.trys.push([3,13,,14]),n=AttachCanceller(SendAsync(t)),this.canceller=n[0],this.moveState!=MoveState.Removed?(LoadManager.RaiseUnLoad(),this.Remove(),this.progress.classList.add("active"),console.debug("Removed")):console.debug("Remove Skipped"),this.moveState=MoveState.Removed,[4,n[1]];case 4:return(c=b.sent(),!c[0])?(this.CancelTask(),console.info("Cancel XHR"),t.abort(),[2]):(console.debug("Downloaded"),r=t.response,n=AttachCanceller(DOMEventsAsync(r)[0]),this.canceller=n[0],[4,n[1]]);case 5:return(l=b.sent(),!l[0])?(this.CancelTask(),[2]):(this.Replace(r),o=this.Insert(r),LoadManager.RaiseReady(),this.progress.classList.remove("active"),this.moveState=MoveState.Replaced,console.debug("Replaced"),n=AttachCanceller(DoEvents()),this.canceller=n[0],[4,n[1]]);case 6:if(a=b.sent(),!a[0])return this.CancelTask(),[2];console.debug("Loading");u=0;b.label=7;case 7:if(!(u<o.length))return[3,12];v=o[u];y=v.getElementsByTagName("img");f=0;b.label=8;case 8:return(f<length)?(s=y[f],!!s.complete)?[3,10]:(n=AttachCanceller(EventAsync(s,"load")),this.canceller=n[0],[4,n[1]]):[3,11];case 9:if(p=b.sent(),!p[0])return this.CancelTask(),[2];b.label=10;case 10:return f++,[3,8];case 11:return u++,[3,7];case 12:return LoadManager.RaiseLoad(),this.moveState=MoveState.Cold,this.canceller=null,console.debug("Loaded"),[3,14];case 13:return w=b.sent(),console.error(w),[3,14];case 14:return[2]}})})},t.prototype.Remove=function(){for(var r,n,u,f,i=document.querySelectorAll("meta[data-ajax^='start-']"),t=0;t<i.length;t++)for(r=i[t],n=r.nextSibling;n!==null;){if(n instanceof HTMLElement&&(u=n,u.matches("meta[data-ajax^='end'")))break;f=n.nextSibling;n.parentElement.removeChild(n);n=f}},t.prototype.Replace=function(n){for(var t,f,e,r=document.querySelectorAll("[data-ajax^='replace-']"),u=n.querySelectorAll("[data-ajax^='replace-']"),i=0;i<r.length;i++)for(t=0;t<u.length;t++)if(f=r[i].getAttribute("data-ajax"),f===u[t].getAttribute("data-ajax")){e=f.split("-")[2];r[i].setAttribute(e,u[t].getAttribute(e));break}},t.prototype.Insert=function(n){for(var u,f,i,e,c,t,l,a,o=[],s=document.querySelectorAll("meta[data-ajax^='start-']"),h=n.querySelectorAll("meta[data-ajax^='start-']"),r=0;r<s.length;r++)for(u=s[r],f=u.nextElementSibling,i=0;i<h.length;i++)if(e=h[i],c=u.getAttribute("data-ajax"),c===e.getAttribute("data-ajax")){for(t=e.nextSibling;t!==null;){if(t instanceof HTMLElement){if(l=t,l.matches("meta[data-ajax^='end'"))break;o.push(t)}a=t.nextSibling;t.parentElement.removeChild(t);f.parentElement.insertBefore(t,f);t=a}break}return o},t.prototype.Ready=function(){var r=this,t,n,i;for(this.progress=document.querySelector("#loader>.progress-ring"),t=document.querySelectorAll("a[href^='/']"),n=0;n<t.length;n++)i=t[n],this.addListener(i,"click",function(n){history.pushState({},"",this.href);r.Move();n.preventDefault()})},t.prototype.Load=function(){},t.prototype.PreUnLoad=function(){var n=document.getElementById("menu-checkbox");n.checked&&(n.checked=!1)},t.prototype.AfterUnLoad=function(){},t}(LoadManager)));LoadManager.AddItem(new(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.Ready=function(){var n=document.getElementById("toc");if(n!=null){var u=n.parentElement,f=document.getElementById("main")||document,t=null,i=8,r=function(){var r,o,s,h,e,l;if(window.getComputedStyle(n).position==="sticky"){var c=u.getBoundingClientRect(),a=Math.max(c.top,i),v=Math.min(c.bottom,window.innerHeight-i);for(n.style.maxHeight=v-a+"px",r=null,o=f.querySelectorAll("h1,h2,h3,h4,h5,h6"),o.length&&(r=o[0]),s=1;s<o.length;s++)if(h=o[s],h.getBoundingClientRect().top<=i)r=h;else break;r!==null&&r.id?t!==r.id&&(t!==null&&n.querySelector("a.current").classList.remove("current"),t=r.id,e=n.querySelector('a[href="#'+encodeURI(r.id)+'"]'),e&&e.classList.add("current")):(t!==null&&n.querySelector("a.current").classList.remove("current"),t=null);t!==null&&(e=n.querySelector('a[href="#'+encodeURI(r.id)+'"]'),e&&(l=e.offsetTop+e.scrollTop+e.clientHeight/2,n.scrollTop=l-n.clientHeight/2))}else n.style.maxHeight=null,t!==null&&(t=null,n.querySelector("a.current").classList.remove("current"))};this.addListener(window,"resize",r);this.addListener(window,"scroll",r);r()}},t.prototype.Load=function(){},t.prototype.PreUnLoad=function(){},t.prototype.AfterUnLoad=function(){},t}(LoadManager)));