function OnReloadClick(){location.reload()}function SendAsync(n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return[2,new Promise(function(t,i){n.onreadystatechange=function(){switch(n.readyState){case 2:(n.status<200||300<=n.status)&&i(n.statusText);break;case 4:200<=n.status&&n.status<300&&t(!0)}n.readyState===4};n.send()})]})})}function AttachCanceller(n){var i=this,t=[undefined,undefined];return t[1]=new Promise(function(r,u){return __awaiter(i,void 0,void 0,function(){var i,f;return __generator(this,function(e){switch(e.label){case 0:t[0]=function(){r&&(r([!1,null]),r=null,u=null)};e.label=1;case 1:return e.trys.push([1,3,,4]),[4,n];case 2:return i=e.sent(),r&&(r([!0,i]),r=null,u=null),[3,4];case 3:return f=e.sent(),u&&(u(f),r=null,u=null),[3,4];case 4:return[2]}})})}),t}function DOMEventsAsync(n){return[new Promise(function(t){n.readyState==="interactive"||n.readyState==="complete"?t(null):n.addEventListener("DOMContentLoaded",function(n){t(n)})}),new Promise(function(t){n.readyState==="complete"?t(null):window.addEventListener("load",function(n){t(n)})})]}function EventAsync(n,t){return console.info("".concat(n.nodeName,":").concat(t,":START")),new Promise(function(i){var r=function(u){i(u);n.removeEventListener(t,r);console.info("".concat(n.nodeName,":").concat(t,":DONE"))};addEventListener(t,r)})}function DoEvents(){return new Promise(function(n){setTimeout(function(){return n(!0)},0)})}var __awaiter=this&&this.__awaiter||function(n,t,i,r){function u(n){return n instanceof i?n:new i(function(t){t(n)})}return new(i||(i=Promise))(function(i,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?i(n.value):u(n.value).then(o,s)}e((r=r.apply(n,t||[])).next())})},__generator=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(o){if(e)throw new TypeError("Generator is already executing.");while(f&&(f=0,o[0]&&(r=0)),r)try{if(e=1,u&&(i=o[0]&2?u["return"]:o[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,o[1])).done)return i;(u=0,i)&&(o=[o[0]&2,i.value]);switch(o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++;u=o[1];o=[0];continue;case 7:o=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(o[0]===6||o[0]===2)){r=0;continue}if(o[0]===3&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(o[0]===6&&r.label<i[1]){r.label=i[1];i=o;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(o);break}i[2]&&r.ops.pop();r.trys.pop();continue}o=t.call(n,r)}catch(s){o=[6,s];u=0}finally{e=i=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},e,u,i,f;return f={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f},__values=this&&this.__values||function(n){var t=typeof Symbol=="function"&&Symbol.iterator,i=t&&n[t],r=0;if(i)return i.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.");},__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__read=this&&this.__read||function(n,t){var i=typeof Symbol=="function"&&n[Symbol.iterator],r,u,f,e;if(!i)return n;r=i.call(n);f=[];try{while((t===void 0||t-->0)&&!(u=r.next()).done)f.push(u.value)}catch(o){e={error:o}}finally{try{u&&!u.done&&(i=r["return"])&&i.call(r)}finally{if(e)throw e.error;}}return f},LoadManager=function(){function n(){this.Listeners=[];this.PreUnLoadFuncs=[];this.AfterUnLoadFuncs=[];this._IsReady=!1;this._IsLoaded=!1}return n.Init=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(i){switch(i.label){case 0:return window.addEventListener("load",function(){return console.info("window.onload")}),[4,DOMEventsAsync(document)];case 1:return t=i.sent(),[4,DoEvents()];case 2:return i.sent(),[4,t[0]];case 3:return i.sent(),n.DOMContentLoaded(),[4,t[1]];case 4:return i.sent(),n.load(),[2]}})})},n.DOMContentLoaded=function(){var u,f,i,t,r;try{for(i=__values(n.Items),t=i.next();!t.done;t=i.next())r=t.value,r.IsReady||(r.Ready(),r._IsReady=!0)}catch(e){u={error:e}}finally{try{t&&!t.done&&(f=i.return)&&f.call(i)}finally{if(u)throw u.error;}}},n.load=function(){var u,f,i,t,r;try{for(i=__values(n.Items),t=i.next();!t.done;t=i.next())r=t.value,r.IsLoaded||(r.Load(),r._IsLoaded=!0)}catch(e){u={error:e}}finally{try{t&&!t.done&&(f=i.return)&&f.call(i)}finally{if(u)throw u.error;}}},n.RaiseUnLoad=function(){var u,f,i,t,r;try{for(i=__values(n.Items),t=i.next();!t.done;t=i.next())r=t.value,r.UnLoadGlobal(),r._IsLoaded=!1,r._IsReady=!1}catch(e){u={error:e}}finally{try{t&&!t.done&&(f=i.return)&&f.call(i)}finally{if(u)throw u.error;}}},n.RaiseReady=function(){Prism.highlightAll();n.DOMContentLoaded()},n.RaiseLoad=function(){n.load()},n.prototype.UnLoadGlobal=function(){var r,u,i,t,n;this.PreUnLoad();try{for(i=__values(this.Listeners),t=i.next();!t.done;t=i.next())n=t.value,n[3]&&n[3](n[0]),n[0].removeEventListener(n[1],n[2])}catch(f){r={error:f}}finally{try{t&&!t.done&&(u=i.return)&&u.call(i)}finally{if(r)throw r.error;}}this.AfterUnLoad();this.Listeners=[]},Object.defineProperty(n.prototype,"IsReady",{get:function(){return this._IsReady},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"IsLoaded",{get:function(){return this._IsLoaded},enumerable:!1,configurable:!0}),n.prototype.addListener=function(n,t,i,r){n.addEventListener(t,i);this.Listeners.push([n,t,i,r])},n.AddItem=function(t){n.Items.push(t)},n.Items=[],n}(),MoveState;LoadManager.Init();LoadManager.AddItem(new(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.Ready=function(){var o=document.getElementById("article"),e,u,f;if(o!==null){var t=document.getElementById("img-checkbox"),i=document.getElementById("img-overlay").lastChild,n,r,h=function(u){r=u;n=document.createElement("div");n.classList.add("dumy-img");u.parentNode.insertBefore(n,u);u.parentNode.removeChild(u);i.appendChild(u);t.checked=!0},s=this.close=function(){r&&(i.removeChild(r),n.parentNode.insertBefore(r,n),n.parentNode.removeChild(n),r=null,n=null,t.checked=!1)};for(this.PreUnLoadFuncs.push(s),this.addListener(t,"change",function(){console.log("change=".concat(t.checked));t.checked||s()}),this.addListener(i,"click",function(){i.classList.toggle("raw-size")}),e=o.querySelectorAll("img"),u=0;u<e.length;u++)(f=e[u],f.parentElement.tagName.toLowerCase()!="a")&&(f.classList.add("clickable"),this.addListener(f,"click",function(n){console.log("click=".concat(t.checked));t.checked?i.classList.toggle("raw-size"):h(this);n.stopPropagation()},function(n){return n.classList.remove("clickable")}))}},t.prototype.Load=function(){},t.prototype.PreUnLoad=function(){this.close&&this.close()},t.prototype.AfterUnLoad=function(){},t}(LoadManager)));var AwaitUtil=function(){function n(){}return n.Immidiate=function(){return new Promise(function(n){return setTimeout(n,0)})},n.AnimationFrame=function(){return new Promise(function(n){return requestAnimationFrame(function(){return n()})})},n.Timeout=function(n){return new Promise(function(t){return setTimeout(t,n)})},n}(),Awaiter=function(){function n(){var n=this;this.isDone=!1;this.hasError=!1;this.resolve=null;this.reject=null;this.task=new Promise(function(t,i){n.isDone?n.hasError?i(n.reason):t(n.result):(n.resolve=t,n.reject=i)})}return n.CreateCompleted=function(t){var i=new n;return i.SetResult(t),i},n.CreateFailed=function(t){var i=new n;return i.ThrowError(t),i},n.prototype.SetResult=function(n){this.isDone||(this.isDone=!0,this.result=n,this.resolve&&this.resolve(n))},n.prototype.ThrowError=function(n){this.isDone||(this.isDone=!0,this.hasError=!0,this.reason=n,this.reject&&this.reject(n))},n}(),AsyncXHR=function(){function n(){this.sended=!1;this._headersReceived=new Awaiter;this._loading=new Awaiter;this._done=new Awaiter;this._xhr=new XMLHttpRequest}return Object.defineProperty(n.prototype,"responseType",{set:function(n){this._xhr.responseType=n},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"response",{get:function(){return this._xhr.response},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"statusCode",{get:function(){return this._xhr.status},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"statusText",{get:function(){return this._xhr.statusText},enumerable:!1,configurable:!0}),n.prototype.send=function(n){this.sended||(this.sended=!0,this._xhr.addEventListener("readystatechange",this.ReadyStateChanged.bind(this)),this._xhr.addEventListener("load",this.Load.bind(this)),this._xhr.addEventListener("error",this.Error.bind(this)),this._xhr.addEventListener("abort",this.Abort.bind(this)),this._xhr.addEventListener("timeout",this.Timeout.bind(this)),this._xhr.send(n))},n.prototype.open=function(n,t){this._xhr.open(n,t,!0)},n.prototype.abort=function(){this._xhr.abort()},n.prototype.ReadyStateChanged=function(){switch(this._xhr.readyState){case 2:this._headersReceived.SetResult(this._xhr.status);break;case 3:this._loading.SetResult(undefined)}},n.prototype.Load=function(){this._done.SetResult(undefined)},n.prototype.Error=function(){var n="リクエストエラー";this._headersReceived.ThrowError(n);this._loading.ThrowError(n);this._done.ThrowError(n)},n.prototype.Abort=function(){var n="キャンセルされました";this._headersReceived.ThrowError(n);this._loading.ThrowError(n);this._done.ThrowError(n)},n.prototype.Timeout=function(){var n="タイムアウト";this._headersReceived.ThrowError(n);this._loading.ThrowError(n);this._done.ThrowError(n)},n.prototype.HeadersReceived=function(){return this._headersReceived.task},n.prototype.Loading=function(){return this._loading.task},n.prototype.Done=function(){return this._done.task},n}(),TimeoutException=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t}(Error),TaskTimeout=function(){function n(n,t){var i=this;this._done=!1;this._targetTask=n;t<0?this.task=this._targetTask:(this.task=new Promise(function(n,t){i._resolve=n;i._reject=t}),n.then(function(n){i._done||(i._done=!0,clearTimeout(i._timeoutId),i._resolve(n))}).catch(function(n){i._done||(i._done=!0,clearTimeout(i._timeoutId),i._reject(n))}),this._timeoutId=setTimeout(function(){i._done||(i._done=!0,i._reject(new TimeoutException))},t))}return n}();(function(n){n[n.Cold=0]="Cold";n[n.Removed=1]="Removed";n[n.Replaced=2]="Replaced"})(MoveState||(MoveState={}));history.pushState!==undefined&&window.onpopstate!==undefined&&LoadManager.AddItem(new(function(n){function t(){var t=n.call(this)||this;return t.oldPathName=document.location.pathname,t.moveState=MoveState.Cold,t.canceller=null,t.sharedAnchorElements=undefined,t.temporaryAnchorElements=new Set,t.stack=[],window.addEventListener("popstate",function(){t.Move()}),t}return __extends(t,n),t.prototype.CancelTask=function(){var t,n,i;for(console.debug("Canceled"),t=this.stack.length,n=0;n<t;n++)i=this.stack.shift(),i.SetResult(this.stack.length==0)},t.prototype.Move=function(){return __awaiter(this,void 0,void 0,function(){var v,u,s,i,h,c,f,y,l,e,p,w,o,a,n,t,r;return __generator(this,function(b){switch(b.label){case 0:return(v=this.oldPathName,u=document.location.pathname,this.oldPathName=u,u===v)?[2]:(console.debug("Requested"),!(this.moveState!==MoveState.Cold))?[3,2]:(console.debug("Cancel Requested"),s=new Awaiter,this.stack.push(s),this.canceller(),[4,s.task]);case 1:if(!b.sent())return[2];b.label=2;case 2:console.debug("Started");i=new AsyncXHR;i.responseType="document";i.open("GET",u);b.label=3;case 3:b.trys.push([3,22,,23]);i.send();this.moveState!=MoveState.Removed?(LoadManager.RaiseUnLoad(),this.Remove(),this.loaderMessage.innerText="",this.loader.classList.add("progress-active"),console.debug("Removed")):console.debug("Remove Skipped");this.loader.classList.remove("reload-active");this.loader.classList.remove("center-active");this.loader.classList.remove("message-active");this.moveState=MoveState.Removed;b.label=4;case 4:return b.trys.push([4,7,,8]),n=AttachCanceller(new TaskTimeout(i.HeadersReceived(),1500).task),this.canceller=n[0],[4,n[1]];case 5:return(t=b.sent(),!t[0])?(this.CancelTask(),[2]):(n=AttachCanceller(new TaskTimeout(i.Done(),5e3).task),this.canceller=n[0],[4,n[1]]);case 6:return(t=b.sent(),!t[0])?(this.CancelTask(),[2]):[3,8];case 7:return h=b.sent(),this.loader.classList.add("reload-active"),this.loader.classList.add("message-active"),this.loaderMessage.innerText=h instanceof TimeoutException?"読み込みに時間がかかっています":h,[3,8];case 8:return b.trys.push([8,12,,13]),n=AttachCanceller(i.HeadersReceived()),this.canceller=n[0],[4,n[1]];case 9:return(t=b.sent(),!t[0])?(this.CancelTask(),[2]):(console.debug("HeaderReceived"),[4,i.Done()]);case 10:return b.sent(),console.debug("XHR Done"),n=AttachCanceller(i.Done()),this.canceller=n[0],[4,n[1]];case 11:return(t=b.sent(),!t[0])?(this.CancelTask(),[2]):(console.debug("Downloaded"),[3,13]);case 12:if(c=b.sent(),c instanceof TimeoutException)throw["Timeout","タイムアウトしました"];else throw["Error",c];return[3,13];case 13:return f=i.response,n=AttachCanceller(DOMEventsAsync(f)[0]),this.canceller=n[0],[4,n[1]];case 14:if(t=b.sent(),!t[0])return this.CancelTask(),[2];if(y=this.Replace(f),!y)if(200<=i.statusCode&&i.statusCode<300)throw["Error","コンテンツが不正でした"];else{console.debug("HeaderError");throw["Error",i.statusText];}return l=this.Insert(f),LoadManager.RaiseReady(),this.moveState=MoveState.Replaced,console.debug("Replaced"),n=AttachCanceller(DoEvents()),this.canceller=n[0],[4,n[1]];case 15:if(t=b.sent(),!t[0])return this.CancelTask(),[2];console.debug("Loading");e=0;b.label=16;case 16:if(!(e<l.length))return[3,21];p=l[e];w=p.getElementsByTagName("img");o=0;b.label=17;case 17:return(o<length)?(a=w[o],!!a.complete)?[3,19]:(n=AttachCanceller(EventAsync(a,"load")),this.canceller=n[0],[4,n[1]]):[3,20];case 18:if(t=b.sent(),!t[0])return this.CancelTask(),[2];b.label=19;case 19:return o++,[3,17];case 20:return e++,[3,16];case 21:return LoadManager.RaiseLoad(),this.moveState=MoveState.Cold,this.canceller=null,console.debug("Loaded"),[3,23];case 22:return r=b.sent(),this.moveState=MoveState.Cold,this.canceller=null,Array.isArray(r)?(this.centerInfo.innerText=r[0],this.loaderMessage.innerText=r[1]):(this.centerInfo.innerText="ERROR",this.centerInfo.innerText=r),this.loader.classList.remove("progress-active"),this.loader.classList.add("center-active"),this.loader.classList.add("message-active"),this.loader.classList.add("reload-active"),console.error(r),[3,23];case 23:return[2]}})})},t.prototype.Remove=function(){var r,u,o=document.querySelectorAll("meta[data-start]"),t,n,e;try{for(t=__values(o),n=t.next();!n.done;n=t.next())for(var f=n.value,s=f.getAttribute("data-start"),i=f.nextSibling;!(i instanceof Element)||i.getAttribute("data-end")!==s;)e=i.nextSibling,i.remove(),i=e}catch(h){r={error:h}}finally{try{n&&!n.done&&(u=t.return)&&u.call(t)}finally{if(r)throw r.error;}}},t.prototype.Replace=function(n){var l,w,a,b,v,k,it=document.querySelectorAll("[data-replace]"),rt=n.querySelectorAll("[data-replace]"),y=new Map,p=new Map,u,t,f,i,o,r,h,c;try{for(u=__values(it),t=u.next();!t.done;t=u.next()){var s=t.value,d=s.getAttribute("data-replace"),ut=y.get(d);if(ut===undefined)y.set(d,s);else return console.error("Multiple data-ajax"),!1}}catch(ft){l={error:ft}}finally{try{t&&!t.done&&(w=u.return)&&w.call(u)}finally{if(l)throw l.error;}}try{for(f=__values(rt),i=f.next();!i.done;i=f.next()){var e=i.value,g=e.getAttribute("data-replace"),et=p.get(g);if(et===undefined)p.set(g,e);else return console.error("Multiple data-ajax"),!1}}catch(ot){a={error:ot}}finally{try{i&&!i.done&&(b=f.return)&&b.call(f)}finally{if(a)throw a.error;}}try{for(o=__values(y),r=o.next();!r.done;r=o.next()){var nt=__read(r.value,2),tt=nt[0],s=nt[1],e=p.get(tt);if(e===undefined)return console.error("data-ajax Only Old Element"),!1;h=tt.split("-")[1];h==="innerHTML"?s.innerHTML=e.innerHTML:(c=e.getAttribute(h),c===null&&(c=""),s.setAttribute(h,c))}}catch(st){v={error:st}}finally{try{r&&!r.done&&(k=o.return)&&k.call(o)}finally{if(v)throw v.error;}}return!0},t.prototype.Insert=function(n){for(var u,f,i,e,c,t,l,a,o=[],s=document.querySelectorAll("meta[data-start]"),h=n.querySelectorAll("meta[data-start]"),r=0;r<s.length;r++)for(u=s[r],f=u.nextElementSibling,i=0;i<h.length;i++)if(e=h[i],c=u.getAttribute("data-start"),c===e.getAttribute("data-start")){for(t=e.nextSibling;t!==null;){if(t instanceof HTMLElement){if(l=t,l.matches("meta[data-end]"))break;o.push(t)}a=t.nextSibling;t.parentElement.removeChild(t);f.parentElement.insertBefore(t,f);t=a}break}return o},t.prototype.anchorClick=function(n,t){history.pushState({},"",n.href);this.Move();t.preventDefault()},t.prototype.Ready=function(){var l,y,o,p,a,w,b="a[href^='/']",s,k,r,n,g,u,t,c,v,nt,f,i,e;this.progress=document.querySelector("#loader>.progress-ring");this.loader=document.getElementById("loader");this.centerInfo=document.getElementById("center-info");this.loaderInfo=document.getElementById("loader-info");this.loaderMessage=document.getElementById("loader-message");s=new Set;k=document.querySelectorAll("meta[data-start]");try{for(r=__values(k),n=r.next();!n.done;n=r.next())for(var d=n.value,tt=d.getAttribute("data-start"),h=d.nextElementSibling;h.getAttribute("data-end")!=tt;){g=h.querySelectorAll(b);try{for(u=(o=void 0,__values(g)),t=u.next();!t.done;t=u.next())c=t.value,this.addListener(c,"click",this.anchorClick.bind(this,c)),s.add(c)}catch(it){o={error:it}}finally{try{t&&!t.done&&(p=u.return)&&p.call(u)}finally{if(o)throw o.error;}}h=h.nextElementSibling}}catch(rt){l={error:rt}}finally{try{n&&!n.done&&(y=r.return)&&y.call(r)}finally{if(l)throw l.error;}}if(this.sharedAnchorElements===undefined){v=new Set;nt=document.querySelectorAll(b);try{for(f=__values(nt),i=f.next();!i.done;i=f.next())e=i.value,s.has(e)||(e.addEventListener("click",this.anchorClick.bind(this,e)),v.add(e))}catch(ut){a={error:ut}}finally{try{i&&!i.done&&(w=f.return)&&w.call(f)}finally{if(a)throw a.error;}}this.sharedAnchorElements=v}this.temporaryAnchorElements=s},t.prototype.Load=function(){},t.prototype.PreUnLoad=function(){var n=document.getElementById("menu-checkbox");n.checked&&(n.checked=!1)},t.prototype.AfterUnLoad=function(){},t}(LoadManager)));LoadManager.AddItem(new(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.Ready=function(){var n=document.getElementById("toc");if(n!=null){var u=n.parentElement,f=document.getElementById("main")||document,t=null,i=8,r=function(){var r,o,s,h,e,l;if(window.getComputedStyle(n).position==="sticky"){var c=u.getBoundingClientRect(),a=Math.max(c.top,i),v=Math.min(c.bottom,window.innerHeight-i);for(n.style.maxHeight=v-a+"px",r=null,o=f.querySelectorAll("h1,h2,h3,h4,h5,h6"),o.length&&(r=o[0]),s=1;s<o.length;s++)if(h=o[s],h.getBoundingClientRect().top<=i)r=h;else break;r!==null&&r.id?t!==r.id&&(t!==null&&n.querySelector("a.current").classList.remove("current"),t=r.id,e=n.querySelector('a[href="#'.concat(encodeURI(r.id),'"]')),e&&e.classList.add("current")):(t!==null&&n.querySelector("a.current").classList.remove("current"),t=null);t!==null&&(e=n.querySelector('a[href="#'.concat(encodeURI(r.id),'"]')),e&&(l=e.offsetTop+e.scrollTop+e.clientHeight/2,n.scrollTop=l-n.clientHeight/2))}else n.style.maxHeight=null,t!==null&&(t=null,n.querySelector("a.current").classList.remove("current"))};this.addListener(window,"resize",r);this.addListener(window,"scroll",r);r()}},t.prototype.Load=function(){},t.prototype.PreUnLoad=function(){},t.prototype.AfterUnLoad=function(){},t}(LoadManager)));